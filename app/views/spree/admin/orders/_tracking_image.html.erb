<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div>
        <h6 class="card-title mb-1">
          <i class="fas fa-image text-primary me-2"></i>
          Imagen de Tracking del Pedido
        </h6>
        <p class="card-text text-muted mb-0">
          Sube una foto o imagen del tracking del pedido
        </p>
      </div>
    </div>

    <% if @order.tracking_image.attached? %>
      <div class="mb-3">
        <div class="d-flex align-items-center gap-3 mb-2">
          <div class="flex-grow-1">
            <p class="mb-0 text-muted small">Imagen actual:</p>
          </div>
          <%= link_to spree.remove_tracking_image_admin_order_path(@order),
              class: "btn btn-sm btn-outline-danger",
              data: { 
                turbo_method: :delete, 
                turbo_confirm: "¿Estás seguro de que quieres eliminar esta imagen?" 
              } do %>
            <i class="fas fa-trash"></i> Eliminar
          <% end %>
        </div>
        <div class="border rounded p-2 bg-light">
          <%= image_tag @order.tracking_image.url, class: "img-fluid rounded", style: "max-height: 400px; width: auto;" if @order.tracking_image.attached? %>
        </div>
      </div>
    <% end %>

    <%= form_with url: spree.upload_tracking_image_admin_order_path(@order),
        method: :post,
        multipart: true,
        data: { turbo_frame: "_top" },
        class: "mt-3" do |f| %>
      <div class="mb-3">
        <%= file_field_tag :tracking_image, 
            accept: "image/*", 
            class: "form-control", 
            required: !@order.tracking_image.attached? %>
        <p class="text-muted small mt-1 mb-0">
          Formatos admitidos: JPG, PNG, HEIC. Tamaño máx. 10MB.
        </p>
      </div>
      <div class="d-flex gap-2">
        <%= submit_tag @order.tracking_image.attached? ? "Actualizar Imagen" : "Subir Imagen", 
            class: "btn btn-primary d-flex align-items-center gap-2" %>
        <% if @order.tracking_image.attached? %>
          <%= link_to spree.send_tracking_whatsapp_admin_order_path(@order),
              class: "btn btn-success d-flex align-items-center gap-2",
              data: { 
                turbo_method: :post,
                turbo_confirm: "¿Enviar la imagen de tracking por WhatsApp al cliente?" 
              } do %>
            <i class="fab fa-whatsapp"></i>
            Enviar tracking por WhatsApp
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

